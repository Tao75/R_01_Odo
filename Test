install.packages("stringr")
install.packages("tidyverse")
install.packages("profvis")

#Gehört zu Package strngr
library("stringr")

#Gehört zu Package tidyverse
library("tidyverse")
library("tidyr")
library("dplyr")
library("readr")

#Gehört zu package profvis
#library("profvis")

#Profiling
#profvis({

#Arbeitsverzeichnis setzen und anzeigen
#directory <-getwd()
#directory

#Runtime Start
start_time <- Sys.time()

#Einlesen des Datensatzes
odo <- read.csv("H:/OneDrive/Arbeit/Daten/Odometer/2019/export.csv")

#Splitten der DateTime Variable in zwei eigene Variablen
odo$regdate <- format(as.POSIXct(strptime(odo$RegistrationDate,"%d.%m.%Y %H:%M:%S",tz="")),format = "%d.%m.%Y")

#Splitten der DateTime Variable in zwei eigene Variablen
odo$inspdate <- format(as.POSIXct(strptime(odo$Date,"%d.%m.%Y %H:%M:%S", tz="")),format = "%d.%m.%Y")
odo$insptime <- format(as.POSIXct(strptime(odo$Date,"%d.%m.%Y %H:%M:%S", tz="")),format = "%H:%M")

#Entfernen der redundanter DateTime variablen
odo <- subset(odo, select = c(1,2,3,5,6,7,8,9,10,12,13,14,15))

#Erstellen Variable bezirk und Befüllen mit Bezirks Kürzel
#Hinweis: Regex-Code steht in Hochkomma eingeklammert, \ des Regex Codes muss mit zweitem \ escaped  werden
odo$bezirk <- sub("\\s.+","",odo$LicenseNumber)

#Erstellen Variable ENDE und Befüllen mit letzten beiden Zeichen des Kennzeichens
odo$ENDE <- str_sub(odo$LicenseNumber, -2,-1)

#Entfernen der Variable LicenseNumbe und Werkstattcode
odo <- subset(odo, select = c(1,3,4,5,6,7,8,10,11,12,13,14,15))

#Speichern als CSV
write.csv(odo, "H:/OneDrive/Arbeit/Daten/Odometer/Export UBA/odometer2019.csv")

#Tabelle aus Speicher nehmen
remove (odo)

#Ende profvis
#})


#end_time <- Sys.time()
#end_time - start_time


#Einlesen des Datensatzes
odo <- read.csv("H:/OneDrive/Arbeit/Daten/Odometer/2020/export.csv")

#Splitten der DateTime Variable in zwei eigene Variablen
odo$regdate <- format(as.POSIXct(strptime(odo$RegistrationDate,"%d.%m.%Y %H:%M:%S",tz="")),format = "%d.%m.%Y")

#Splitten der DateTime Variable in zwei eigene Variablen
odo$inspdate <- format(as.POSIXct(strptime(odo$Date,"%d.%m.%Y %H:%M:%S", tz="")),format = "%d.%m.%Y")
odo$insptime <- format(as.POSIXct(strptime(odo$Date,"%d.%m.%Y %H:%M:%S", tz="")),format = "%H:%M")

#Entfernen der redundanter DateTime variablen
odo <- subset(odo, select = c(1,2,3,5,6,7,8,9,10,12,13,14,15))

#Erstellen Variable bezirk und Befüllen mit Bezirks Kürzel
#Hinweis: Regex-Code steht in Hochkomma eingeklammert, \ des Regex Codes muss mit zweitem \ escaped  werden
odo$bezirk <- sub("\\s.+","",odo$LicenseNumber)

#Erstellen Variable ENDE und Befüllen mit letzten beiden Zeichen des Kennzeichens
odo$ENDE <- str_sub(odo$LicenseNumber, -2,-1)

#Entfernen der Variable LicenseNumbe und Werkstattcode
odo <- subset(odo, select = c(1,3,4,5,6,7,8,10,11,12,13,14,15))

#Speichern als CSV
write.csv(odo, "H:/OneDrive/Arbeit/Daten/Odometer/Export UBA/odometer2020.csv")

#Tabelle aus Speicher nehmen
remove (odo)



#Einlesen des Datensatzes
odo <- read.csv("H:/OneDrive/Arbeit/Daten/Odometer/2021/export.csv")

#Splitten der DateTime Variable in zwei eigene Variablen
odo$regdate <- format(as.POSIXct(strptime(odo$RegistrationDate,"%d.%m.%Y %H:%M:%S",tz="")),format = "%d.%m.%Y")

#Splitten der DateTime Variable in zwei eigene Variablen
odo$inspdate <- format(as.POSIXct(strptime(odo$Date,"%d.%m.%Y %H:%M:%S", tz="")),format = "%d.%m.%Y")
odo$insptime <- format(as.POSIXct(strptime(odo$Date,"%d.%m.%Y %H:%M:%S", tz="")),format = "%H:%M")

#Entfernen der redundanter DateTime variablen
odo <- subset(odo, select = c(1,2,3,5,6,7,8,9,10,12,13,14,15))

#Erstellen Variable bezirk und Befüllen mit Bezirks Kürzel
#Hinweis: Regex-Code steht in Hochkomma eingeklammert, \ des Regex Codes muss mit zweitem \ escaped  werden
odo$bezirk <- sub("\\s.+","",odo$LicenseNumber)

#Erstellen Variable ENDE und Befüllen mit letzten beiden Zeichen des Kennzeichens
odo$ENDE <- str_sub(odo$LicenseNumber, -2,-1)

#Entfernen der Variable LicenseNumbe und Werkstattcode
odo <- subset(odo, select = c(1,3,4,5,6,7,8,10,11,12,13,14,15))

#Speichern als CSV
write.csv(odo, "H:/OneDrive/Arbeit/Daten/Odometer/Export UBA/odometer2021.csv")

#Tabelle aus Speicher nehmen
remove (odo)

#Runtime End
end_time <- Sys.time()
end_time - start_time
